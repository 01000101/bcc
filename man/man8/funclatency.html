Content-type: text/html; charset=UTF-8

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of funclatency</TITLE>
</HEAD><BODY>
<H1>funclatency</H1>
Section: Maintenance Commands (8)<BR>Updated: 2015-08-18<BR><A HREF="#index">Index</A>
<A HREF="https://iovisor.github.io/bcc">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

funclatency - Time functions and print latency as a histogram.
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<B>funclatency [-h] [-p PID] [-i INTERVAL] [-d DURATION] [-T] [-u] [-m] [-F] [-r] [-v] pattern</B>

<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

This tool traces function calls and times their duration (latency), and
shows the latency distribution as a histogram. The time is measured from when
the function is called to when it returns, and is inclusive of both on-CPU
time and time spent blocked.
<P>
This tool uses in-kernel eBPF maps for storing timestamps and the histogram,
for efficiency.
<P>
Currently nested or recursive functions are not supported properly, and
timestamps will be overwritten, creating dubious output. Try to match single
functions, or groups of functions that run at the same stack layer, and
don't ultimately call each other.
<P>
WARNING: This uses dynamic tracing of (what can be many) functions, an
activity that has had issues on some kernel versions (risk of panics or
freezes). Test, and know what you are doing, before use.
<P>
Since this uses BPF, only the root user can use this tool.
<A NAME="lbAE">&nbsp;</A>
<H2>REQUIREMENTS</H2>

CONFIG_BPF and bcc.
<A NAME="lbAF">&nbsp;</A>
<H2>OPTIONS</H2>

pattern
Function name or search pattern. Supports &quot;*&quot; wildcards. See EXAMPLES.
You can also use -r for regular expressions.
-h
Print usage message.
<DL COMPACT>
<DT>-p PID<DD>
Trace this process ID only.
<DT>-i INTERVAL<DD>
Print output every interval seconds.
<DT>-d DURATION<DD>
Total duration of trace, in seconds.
<DT>-T<DD>
Include timestamps on output.
<DT>-u<DD>
Output histogram in microseconds.
<DT>-m<DD>
Output histogram in milliseconds.
<DT>-F<DD>
Print a separate histogram per function matched.
<DT>-r<DD>
Use regular expressions for the search pattern.
<DT>-v<DD>
Print the BPF program (for debugging purposes).
</DL>
<A NAME="lbAG">&nbsp;</A>
<H2>EXAMPLES</H2>

<DL COMPACT>
<DT>Time the do_sys_open() kernel function, and print the distribution as a histogram:<DD>
#
<B>funclatency do_sys_open</B>

<DT>Time the read() function in libc across all processes on the system:<DD>
#
<B>funclatency c:read</B>

<DT>Time vfs_read(), and print the histogram in units of microseconds:<DD>
#
<B>funclatency -u vfs_read</B>

<DT>Time do_nanosleep(), and print the histogram in units of milliseconds:<DD>
#
<B>funclatency -m do_nanosleep</B>

<DT>Time libc open(), and print output every 2 seconds, for duration 10 seconds:<DD>
#
<B>funclatency -i 2 -d 10 c:read</B>

<DT>Time vfs_read(), and print output every 5 seconds, with timestamps:<DD>
#
<B>funclatency -mTi 5 vfs_read</B>

<DT>Time vfs_read() for process ID 181 only:<DD>
#
<B>funclatency -p 181 vfs_read:</B>

<DT>Time both vfs_fstat() and vfs_fstatat() calls, by use of a wildcard:<DD>
#
<B>funclatency 'vfs_fstat*'</B>

<DT>Time both vfs_fstat* calls, and print a separate histogram for each:<DD>
#
<B>funclatency -F 'vfs_fstat*'</B>

</DL>
<A NAME="lbAH">&nbsp;</A>
<H2>FIELDS</H2>

<DL COMPACT>
<DT>necs<DD>
Nanosecond range
<DT>usecs<DD>
Microsecond range
<DT>msecs<DD>
Millisecond range
<DT>count<DD>
How many calls fell into this range
<DT>distribution<DD>
An ASCII bar chart to visualize the distribution (count column)
</DL>
<A NAME="lbAI">&nbsp;</A>
<H2>OVERHEAD</H2>

This traces kernel functions and maintains in-kernel timestamps and a histogram,
which are asynchronously copied to user-space. While this method is very
efficient, the rate of kernel functions can also be very high (&gt;1M/sec), at
which point the overhead is expected to be measurable. Measure in a test
environment and understand overheads before use. You can also use funccount
to measure the rate of kernel functions over a short duration, to set some
expectations before use.
<A NAME="lbAJ">&nbsp;</A>
<H2>SOURCE</H2>

This is from bcc.
<DL COMPACT>
<DT><DD>
<A HREF="https://github.com/iovisor/bcc">https://github.com/iovisor/bcc</A>
</DL>
<P>

Also look in the bcc distribution for a companion _examples.txt file containing
example usage, output, and commentary for this tool.
<A NAME="lbAK">&nbsp;</A>
<H2>OS</H2>

Linux
<A NAME="lbAL">&nbsp;</A>
<H2>STABILITY</H2>

Unstable - in development.
<A NAME="lbAM">&nbsp;</A>
<H2>AUTHOR</H2>

Brendan Gregg, Sasha Goldshtein
<A NAME="lbAN">&nbsp;</A>
<H2>SEE ALSO</H2>

<A HREF="https://iovisor.github.io/bcc?8+funccount">funccount</A>(8)
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">REQUIREMENTS</A><DD>
<DT><A HREF="#lbAF">OPTIONS</A><DD>
<DT><A HREF="#lbAG">EXAMPLES</A><DD>
<DT><A HREF="#lbAH">FIELDS</A><DD>
<DT><A HREF="#lbAI">OVERHEAD</A><DD>
<DT><A HREF="#lbAJ">SOURCE</A><DD>
<DT><A HREF="#lbAK">OS</A><DD>
<DT><A HREF="#lbAL">STABILITY</A><DD>
<DT><A HREF="#lbAM">AUTHOR</A><DD>
<DT><A HREF="#lbAN">SEE ALSO</A><DD>
</DL>
<HR>
This document was created by
<A HREF="https://iovisor.github.io/bcc">man2html</A>,
using the manual pages.<BR>
Time: 17:11:49 GMT, February 25, 2020
</BODY>
</HTML>
